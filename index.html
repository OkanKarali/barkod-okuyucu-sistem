<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barkod Okuyucu Kasa Sistemi</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- html5-qrcode library for barcode scanning -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #qr-reader-region {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            overflow: hidden;
        }
        @keyframes highlight {
            0% { background-color: #dbeafe; } /* blue-100 */
            100% { background-color: transparent; }
        }
        .highlight-item {
            animation: highlight 1.5s ease-out;
        }
        .delete-button:hover svg {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-xl p-6 space-y-6">
        
        <div class="text-center">
            <h1 class="text-2xl font-bold text-slate-800">Barkod Okuyucu Kasa</h1>
            <p class="text-sm text-slate-500 mt-1">Ürün barkodunu okutarak listeye ekleyin.</p>
        </div>

        <div id="scanner-container" class="bg-slate-200 rounded-lg p-2">
            <div id="qr-reader" class="w-full"></div>
            <p id="scanner-status" class="text-center text-sm text-slate-600 mt-2">Kamera başlatılıyor...</p>
        </div>
        
        <div id="scan-result-container" class="h-12 flex items-center justify-center bg-gray-50 rounded-lg transition-all duration-300">
             <p id="scan-result" class="text-center text-slate-700 font-medium">Kamerayı bir barkoda doğrultun</p>
        </div>

        <div>
            <h2 class="text-lg font-semibold text-slate-700 mb-2">Okutulan Ürünler</h2>
            <div id="scanned-items-list" class="space-y-2 max-h-60 overflow-y-auto bg-slate-50 p-3 rounded-lg border">
                <p id="empty-cart-message" class="text-slate-500 text-center">Henüz ürün okutulmadı.</p>
            </div>
        </div>

        <div class="border-t pt-4 space-y-4">
            <div class="flex justify-between items-center">
                <span class="text-xl font-bold text-slate-800">TOPLAM:</span>
                <span id="total-price" class="text-2xl font-bold text-blue-600">0.00 TL</span>
            </div>
            <button id="reset-button" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-all shadow-md hover:shadow-lg">
                Listeyi Sıfırla
            </button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Product Database ---
            const productDatabase = {
                '8690632055610': { name: 'Ülker Çikolatalı Gofret', price: 7.50 },
                '8690504012177': { name: 'Eti Canga 45g', price: 9.75 },
                '8690123456789': { name: 'Dimes Meyve Suyu 1L', price: 32.25 },
                '8690987654321': { name: 'Pınar Süt 1L', price: 38.50 },
                '8681234567890': { name: 'Saka Su 0.5L', price: 5.00 },
                '8690526000018': { name: 'Tadım Ay Çekirdeği', price: 25.00 },
                '8697404547012': { name: 'Fuse Tea Şeftali 1L', price: 28.90 },
                '5000112664553': { name: 'Coca Cola 2.5lt', price: 75.00 },
                '5000112672039': { name: 'Coca Cola 1.5lt', price: 65.00 },
            };

            // --- Application State ---
            // We use an object to store cart items to easily manage quantities.
            let cart = {}; 
            let lastScanTime = 0;

            // --- DOM Element References ---
            const scannedItemsList = document.getElementById('scanned-items-list');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const totalPriceElement = document.getElementById('total-price');
            const scanResultElement = document.getElementById('scan-result');
            const scannerStatusElement = document.getElementById('scanner-status');
            const resetButton = document.getElementById('reset-button');

            // --- Main Functions ---

            /**
             * Updates the UI based on the current cart state.
             * It re-renders the list, shows quantities, adds delete buttons, and recalculates the total.
             */
            function updateCartUI() {
                scannedItemsList.innerHTML = '';

                if (Object.keys(cart).length === 0) {
                    scannedItemsList.appendChild(emptyCartMessage);
                    emptyCartMessage.style.display = 'block';
                } else {
                    emptyCartMessage.style.display = 'none';
                    
                    for (const barcode in cart) {
                        const item = cart[barcode];
                        const listItem = document.createElement('div');
                        listItem.className = 'flex justify-between items-center bg-white p-2 rounded-md shadow-sm';
                        // Add highlight animation only to the last added item.
                        if (item.isNew) {
                           listItem.classList.add('highlight-item');
                           delete item.isNew; // Remove the flag after applying animation
                        }
                        
                        // Item Name and Quantity
                        const nameAndQty = document.createElement('span');
                        nameAndQty.className = 'text-slate-800';
                        nameAndQty.textContent = `${item.name} (x${item.quantity})`;
                        
                        // Item Price and Delete Button
                        const priceAndButton = document.createElement('div');
                        priceAndButton.className = 'flex items-center space-x-4';

                        const itemPrice = document.createElement('span');
                        itemPrice.className = 'font-semibold text-slate-600';
                        itemPrice.textContent = `${(item.price * item.quantity).toFixed(2)} TL`;

                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'delete-button text-red-400 hover:text-red-600 transition-colors';
                        deleteBtn.setAttribute('data-barcode', barcode);
                        deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>`;

                        priceAndButton.appendChild(itemPrice);
                        priceAndButton.appendChild(deleteBtn);
                        
                        listItem.appendChild(nameAndQty);
                        listItem.appendChild(priceAndButton);
                        
                        scannedItemsList.appendChild(listItem);
                    }
                    scannedItemsList.scrollTop = scannedItemsList.scrollHeight;
                }
                
                // Update total price display
                const total = Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
                totalPriceElement.textContent = `${total.toFixed(2)} TL`;
            }
            
            /**
             * Handles successful barcode scans.
             */
            function onScanSuccess(decodedText, decodedResult) {
                const now = Date.now();
                if (now - lastScanTime < 2000) { return; }
                lastScanTime = now;

                const productInfo = productDatabase[decodedText];

                if (productInfo) {
                    scanResultElement.textContent = `Eklendi: ${productInfo.name}`;
                    scanResultElement.parentElement.classList.add('bg-green-100');
                    scanResultElement.parentElement.classList.remove('bg-red-100');
                    
                    // If item is already in cart, increase quantity. Otherwise, add it.
                    if (cart[decodedText]) {
                        cart[decodedText].quantity++;
                    } else {
                        cart[decodedText] = {
                            ...productInfo,
                            quantity: 1,
                            isNew: true // Flag to trigger animation
                        };
                    }
                    
                    updateCartUI();

                } else {
                    scanResultElement.textContent = `Ürün bulunamadı: ${decodedText}`;
                    scanResultElement.parentElement.classList.add('bg-red-100');
                    scanResultElement.parentElement.classList.remove('bg-green-100');
                }

                setTimeout(() => {
                    scanResultElement.parentElement.classList.remove('bg-green-100', 'bg-red-100');
                }, 1500);
            }

            function onScanFailure(error) { /* Be quiet on failure */ }
            
            /**
             * Resets the cart to its initial state.
             */
            function resetScanner() {
                cart = {};
                scanResultElement.textContent = 'Liste temizlendi. Yeni tarama yapabilirsiniz.';
                updateCartUI();
            }

            /**
             * Handles clicks on the delete buttons using event delegation.
             */
            function handleCartClick(event) {
                const deleteButton = event.target.closest('.delete-button');
                if (deleteButton) {
                    const barcodeToDelete = deleteButton.dataset.barcode;
                    if (cart[barcodeToDelete]) {
                        delete cart[barcodeToDelete];
                        updateCartUI();
                    }
                }
            }


            // --- Initialization ---
            const html5QrCode = new Html5Qrcode("qr-reader");
            const config = { fps: 10, qrbox: { width: 250, height: 150 } };

            html5QrCode.start(
                { facingMode: "environment" }, config, onScanSuccess, onScanFailure
            ).then(() => {
                scannerStatusElement.textContent = 'Kamera aktif. Barkodu taratın.';
                document.getElementById('qr-reader-region').style.borderStyle = 'solid';
            }).catch(err => {
                scannerStatusElement.textContent = 'Kamera başlatılamadı! Lütfen izinleri kontrol edin.';
                scannerStatusElement.classList.add('text-red-600', 'font-semibold');
            });

            resetButton.addEventListener('click', resetScanner);
            scannedItemsList.addEventListener('click', handleCartClick);
            
            updateCartUI();
        });
    </script>
</body>
</html>
