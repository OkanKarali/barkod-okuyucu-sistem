<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barkod Okuyucu iOS Destekli</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 20px;
      text-align: center;
    }
    #qr-reader {
      width: 100%;
      max-width: 400px;
      margin: auto;
      border: 2px solid #007bff;
      border-radius: 8px;
    }
    #scanner-status {
      margin-top: 10px;
      color: #666;
    }
    #scan-result {
      margin-top: 20px;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h1>Barkod Okuyucu</h1>
  <div id="qr-reader"></div>
  <p id="scanner-status">Kamera başlatılıyor...</p>
  <p id="scan-result"></p>

  <script>
    const scannerStatusElement = document.getElementById("scanner-status");
    const scanResultElement = document.getElementById("scan-result");

    const mainScanner = new Html5Qrcode("qr-reader");
    let isMainScannerActive = false;
    let lastScanTime = 0;

    function startMainScanner() {
      if (isMainScannerActive) return;

      scannerStatusElement.textContent = "Kamera başlatılıyor...";

      const config = {
        fps: 10,
        qrbox: { width: 300, height: 300 },
        aspectRatio: 1.7777778 // 16:9
      };

      const constraints = {
        video: {
          facingMode: "environment",
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };

      mainScanner.start(constraints, config, onMainScanSuccess)
        .then(() => {
          isMainScannerActive = true;
          scannerStatusElement.textContent = "Kamera aktif. Barkodu gösterin.";
        })
        .catch(err => {
          console.error("Kamera başlatılamadı:", err);
          scannerStatusElement.textContent = `Kamera başlatılamadı: ${err}`;
        });
    }

    function onMainScanSuccess(decodedText) {
      if (Date.now() - lastScanTime < 1500) return;
      lastScanTime = Date.now();
      scanResultElement.textContent = "Okundu: " + decodedText;
    }

    // Başlat
    startMainScanner();
  </script>
</body>
</html>
